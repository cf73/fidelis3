{"version":3,"file":"PreOwned-CkUypdCb.js","sources":["../../src/pages/PreOwned.tsx"],"sourcesContent":["/**\r\n * @preserve-visual-language\r\n * DO NOT MODIFY: Functionality, data handling, or business logic\r\n * Only modify: Visual styling, layout, and user experience\r\n * \r\n * Visual Language:\r\n * - Colors: Primary blue, accent gold, neutral grays\r\n * - Typography: Inter font, established scale\r\n * - Spacing: 4px base unit system\r\n * - Layout: Responsive grid, consistent padding\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { motion } from 'framer-motion';\r\nimport { MagnifyingGlassIcon, TagIcon, TruckIcon, CubeIcon } from '@heroicons/react/24/outline';\r\nimport { getPreOwned, getImageUrl, type PreOwned } from '../lib/supabase';\r\nimport { \r\n  Section, \r\n  Container, \r\n  Grid, \r\n  Flex, \r\n  H1, \r\n  H2, \r\n  H3, \r\n  Body, \r\n  BodyLarge, \r\n  Button,\r\n  PreOwnedCard,\r\n  ValueCard\r\n} from '../components/ui';\r\nimport { getRandomMusicalMessage } from '../utils/musicalLoadingMessages';\r\n\r\nconst PreOwned: React.FC = () => {\r\n  const [preOwnedItems, setPreOwnedItems] = useState<PreOwned[]>([]);\r\n  const [filteredItems, setFilteredItems] = useState<PreOwned[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [showLocalOnly, setShowLocalOnly] = useState(false);\r\n  const [showInitialSpinner, setShowInitialSpinner] = useState(true);\r\n  const [cardsVisible, setCardsVisible] = useState<boolean[]>([]);\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const data = await getPreOwned();\r\n        setPreOwnedItems(data);\r\n        setFilteredItems(data);\r\n        \r\n        // Preload all first images\r\n        const preloadPromises = data.map(item => {\r\n          return new Promise<void>((resolve) => {\r\n            if (item.images && item.images.length > 0) {\r\n              const img = new Image();\r\n              img.onload = () => resolve();\r\n              img.onerror = () => resolve(); // Resolve even on error\r\n              img.src = getImageUrl(item.images[0]);\r\n            } else {\r\n              resolve(); // No image to load\r\n            }\r\n          });\r\n        });\r\n        \r\n        // Wait for all images to preload (with timeout)\r\n        const preloadWithTimeout = Promise.race([\r\n          Promise.all(preloadPromises),\r\n          new Promise(resolve => setTimeout(resolve, 3000)) // 3 second timeout\r\n        ]);\r\n        \r\n        await preloadWithTimeout;\r\n        \r\n        // Initialize cards as hidden\r\n        setCardsVisible(new Array(data.length).fill(false));\r\n        \r\n        // Hide spinner and start sequential animation\r\n        setShowInitialSpinner(false);\r\n        \r\n        // Trigger sequential card animation\r\n        setTimeout(() => {\r\n          data.forEach((_, index) => {\r\n            setTimeout(() => {\r\n              setCardsVisible(prev => {\r\n                const newVisible = [...prev];\r\n                newVisible[index] = true;\r\n                return newVisible;\r\n              });\r\n            }, index * 80); // Fast 80ms intervals\r\n          });\r\n        }, 200); // Brief delay after spinner disappears\r\n        \r\n      } catch (error) {\r\n        console.error('Error loading pre-owned data:', error);\r\n        setPreOwnedItems([]);\r\n        setFilteredItems([]);\r\n        setShowInitialSpinner(false);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let filtered = preOwnedItems;\r\n\r\n    // Search filter\r\n    if (searchTerm) {\r\n      filtered = filtered.filter(item =>\r\n        item.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        item.description?.toLowerCase().includes(searchTerm.toLowerCase())\r\n      );\r\n    }\r\n\r\n    // Local only filter\r\n    if (showLocalOnly) {\r\n      filtered = filtered.filter(item => item.local_only);\r\n    }\r\n\r\n    setFilteredItems(filtered);\r\n    \r\n    // Reset and animate cards when filters change\r\n    if (filtered.length !== filteredItems.length) {\r\n      setCardsVisible(new Array(filtered.length).fill(false));\r\n      setTimeout(() => {\r\n        filtered.forEach((_, index) => {\r\n          setTimeout(() => {\r\n            setCardsVisible(prev => {\r\n              const newVisible = [...prev];\r\n              newVisible[index] = true;\r\n              return newVisible;\r\n            });\r\n          }, index * 60); // Even faster for filter changes\r\n        });\r\n      }, 100);\r\n    }\r\n  }, [preOwnedItems, searchTerm, showLocalOnly, filteredItems.length]);\r\n\r\n  if (loading || showInitialSpinner) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-[#fffcf9]\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-600 mx-auto\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{getRandomMusicalMessage()}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0 }}\r\n      animate={{ opacity: 1 }}\r\n      transition={{ duration: 0.5 }}\r\n      className=\"min-h-screen bg-[#fffcf9]\"\r\n    >\r\n      {/* Hero Section */}\r\n      <Section variant=\"hero\" background=\"custom\" customBackground=\"bg-warm-beige\" className=\"-mt-4\">\r\n        <Container size=\"6xl\">\r\n          <div className=\"max-w-4xl\">\r\n            <h1 className=\"text-4xl lg:text-5xl xl:text-6xl font-light text-stone-900 leading-tight tracking-wide mb-6\">Pre-Owned Equipment</h1>\r\n            <div className=\"prose prose-stone prose-lg max-w-none text-stone-700 leading-relaxed\">\r\n              <p className=\"mb-6\">\r\n                Quality audio gear is built to last. Many of the components we sell pre-owned deliver performance that rivals or exceeds newer equipment at significantly higher prices.\r\n              </p>\r\n              <p className=\"mb-6\">\r\n                We thoroughly test and inspect every item before it goes on our floor. Each piece meets the same standards we apply to new equipment.\r\n              </p>\r\n              <p>\r\n                Pre-owned gear offers serious value for both newcomers and seasoned audiophiles looking to upgrade or complete their systems.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </Container>\r\n      </Section>\r\n\r\n\r\n\r\n      {/* Results Grid */}\r\n      <Section variant=\"compact\" background=\"custom\" customBackground=\"bg-[#fffcf9]\">\r\n        <Container size=\"6xl\">\r\n          {filteredItems.length > 0 ? (\r\n            <>\r\n              {/* Search, Local Filter, and Results Count */}\r\n              <div className=\"mb-6 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4\">\r\n                <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-4\">\r\n                  <div className=\"relative max-w-md\">\r\n                    <MagnifyingGlassIcon className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\" />\r\n                    <input\r\n                      type=\"text\"\r\n                      placeholder=\"Search...\"\r\n                      value={searchTerm}\r\n                      onChange={(e) => setSearchTerm(e.target.value)}\r\n                      className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-accent-500 focus:border-transparent transition-all duration-300 bg-white\"\r\n                    />\r\n                  </div>\r\n                  <label className=\"flex items-center gap-2 cursor-pointer whitespace-nowrap\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={showLocalOnly}\r\n                      onChange={(e) => setShowLocalOnly(e.target.checked)}\r\n                      className=\"rounded border-gray-300 text-accent-600 focus:ring-accent-500\"\r\n                    />\r\n                    <span className=\"text-sm text-gray-700\">Local pickup only</span>\r\n                  </label>\r\n                </div>\r\n                <p className=\"text-gray-600\">\r\n                  Showing {filteredItems.length} pre-owned item{filteredItems.length !== 1 ? 's' : ''}\r\n                </p>\r\n              </div>\r\n              \r\n              {/* Grid */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-10\">\r\n                {filteredItems.map((item, index) => (\r\n                  <Link key={item.id} to={`/pre-owned/${item.id}`} className=\"block h-full group\">\r\n                    <PreOwnedCard \r\n                      item={item} \r\n                      className=\"h-full\" \r\n                      index={index}\r\n                      isVisible={cardsVisible[index] || false}\r\n                    />\r\n                  </Link>\r\n                ))}\r\n              </div>\r\n            </>\r\n          ) : (\r\n            <div className=\"text-center py-16\">\r\n              <div className=\"text-6xl mb-4\">üîç</div>\r\n              <H3 className=\"mb-2\">No items found</H3>\r\n              <Body className=\"text-gray-600\">\r\n                Try adjusting your search criteria or check back later for new arrivals.\r\n              </Body>\r\n            </div>\r\n          )}\r\n        </Container>\r\n      </Section>\r\n\r\n      {/* Trade-In Section */}\r\n      <Section variant=\"compact\" background=\"custom\" customBackground=\"bg-warm-beige\">\r\n        <Container size=\"6xl\">\r\n          <div className=\"max-w-4xl\">\r\n            <motion.div\r\n              initial={{ opacity: 0, y: 20 }}\r\n              whileInView={{ opacity: 1, y: 0 }}\r\n              transition={{ duration: 0.6 }}\r\n              className=\"mb-8\"\r\n            >\r\n              <H2 className=\"text-stone-900 mb-6\">Trade In Your Gear</H2>\r\n              <div className=\"prose prose-stone prose-lg max-w-none text-stone-700 leading-relaxed\">\r\n                <p className=\"mb-6\">\r\n                  Looking to upgrade? We accept quality audio equipment as trade toward new gear. \r\n                  Our team evaluates each piece fairly, considering current market value and condition.\r\n                </p>\r\n                <p className=\"mb-8\">\r\n                  From vintage classics to recent high-end components, we're interested in gear that \r\n                  meets our standards. Trade values can significantly reduce the cost of your next upgrade.\r\n                </p>\r\n              </div>\r\n            </motion.div>\r\n            \r\n            <motion.div\r\n              initial={{ opacity: 0, y: 20 }}\r\n              whileInView={{ opacity: 1, y: 0 }}\r\n              transition={{ duration: 0.6, delay: 0.2 }}\r\n            >\r\n              <Link\r\n                to=\"/contact?subject=Trade-In%20Inquiry&message=I%27m%20interested%20in%20trading%20in%20my%20audio%20equipment.%20Here%27s%20what%20I%20have%3A%0A%0A\"\r\n                className=\"inline-flex items-center gap-3 bg-stone-900 text-white px-8 py-4 font-medium tracking-wide hover:bg-stone-800 transition-all duration-300 shadow-sm hover:shadow-md group\"\r\n              >\r\n                Get Trade-In Quote\r\n                <svg className=\"w-4 h-4 group-hover:translate-x-0.5 transition-transform duration-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n                </svg>\r\n              </Link>\r\n            </motion.div>\r\n          </div>\r\n        </Container>\r\n      </Section>\r\n\r\n    </motion.div>\r\n  );\r\n};\r\n\r\nexport { PreOwned }; "],"names":["PreOwned","preOwnedItems","setPreOwnedItems","useState","filteredItems","setFilteredItems","loading","setLoading","searchTerm","setSearchTerm","showLocalOnly","setShowLocalOnly","showInitialSpinner","setShowInitialSpinner","cardsVisible","setCardsVisible","useEffect","data","getPreOwned","preloadPromises","item","resolve","img","getImageUrl","_","index","prev","newVisible","error","filtered","jsxs","jsx","motion","Section","Container","Fragment","MagnifyingGlassIcon","e","Link","PreOwnedCard","H3","Body","H2"],"mappings":"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"}